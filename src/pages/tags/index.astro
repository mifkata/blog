---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Container from "../../components/Container.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import Tag from "../../components/Tag.astro";
import { SITE_TITLE } from "../../consts";

const posts = await getCollection("blog");
const tagCounts = posts
  .flatMap((post) => post.data.tags)
  .reduce(
    (acc, tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );
const tags = Object.entries(tagCounts).sort((a, b) => a[0].localeCompare(b[0]));
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title={`Tags | ${SITE_TITLE}`}
      description="Browse posts by tag"
    />
  </head>
  <body>
    <div class="content-wrapper">
      <Header />
      <Container>
        <section>
          <h1>Tags</h1>
          <div class="flex flex-wrap gap-3 my-8">
            {
              tags.map(([tag, count]) => (
                <span class="inline-flex items-center gap-2">
                  <Tag tag={tag} />
                  <span class="text-gray text-sm">({count})</span>
                </span>
              ))
            }
          </div>
        </section>
      </Container>
      <Footer />
    </div>
  </body>
</html>
