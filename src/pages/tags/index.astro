---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Container from "../../components/Container.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";

const posts = await getCollection("blog");
const tagCounts = posts
  .flatMap((post) => post.data.tags)
  .reduce(
    (acc, tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );
const tags = Object.entries(tagCounts).sort((a, b) => a[0].localeCompare(b[0]));
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title={`Tags | ${SITE_TITLE}`}
      description="Browse posts by tag"
    />
  </head>
  <body>
    <Header />
    <Container>
      <section>
        <h1>Tags</h1>
        <ul class="list-none my-8 p-0">
          {
            tags.map(([tag, count]) => (
              <li class="mb-2">
                <a
                  href={`/tags/${tag}/`}
                  class="no-underline text-black hover:text-accent"
                >
                  {tag}
                </a>{" "}
                <span class="text-gray">({count})</span>
              </li>
            ))
          }
        </ul>
      </section>
    </Container>
    <Footer />
  </body>
</html>
