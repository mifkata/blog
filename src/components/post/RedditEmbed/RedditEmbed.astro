---
interface Props {
  url: string;
  height?: number;
}

const { url, height = 320 } = Astro.props;

// Extract post ID from Reddit URL
// Formats: https://www.reddit.com/r/subreddit/comments/postid/title/
//          https://reddit.com/r/subreddit/comments/postid/
const match = url.match(/reddit\.com\/r\/[\w]+\/comments\/([\w]+)/);
const postId = match ? match[1] : null;
const embedUrl = postId
  ? `https://www.redditmedia.com/r/${url.split("/r/")[1]?.split("?")[0]}?ref_source=embed&ref=share&embed=true`
  : null;
---

{
  embedUrl ? (
    <div class="reddit-embed my-6" data-url={embedUrl} data-height={height}>
      <div class="border border-gray-light rounded-lg p-4 bg-gray-light/20 text-center">
        <p class="m-0 mb-2 text-gray">Reddit Post</p>
        <a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          class="text-accent hover:text-accent-dark"
        >
          View on Reddit
        </a>
      </div>
    </div>
  ) : (
    <p class="text-red-500">Invalid Reddit URL</p>
  )
}

<script>
  import { initRedditEmbeds } from "./redditEmbed";
  initRedditEmbeds();
  document.addEventListener("astro:page-load", initRedditEmbeds);
</script>
