---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import type { MarkdownHeading } from "astro";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import Tag from "../components/Tag.astro";

type Props = CollectionEntry<"blog">["data"] & { headings?: MarkdownHeading[] };

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags,
  headings = [],
} = Astro.props;
const showToc = headings.length >= 2;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body>
    <Header />
    <main class="w-[calc(100%-2em)] max-w-full m-0">
      <article>
        <div class="w-full">
          {
            heroImage && (
              <Image
                width={1020}
                height={510}
                src={heroImage}
                alt=""
                class="block mx-auto rounded-xl shadow-lg"
              />
            )
          }
        </div>
        <div class="flex gap-8 max-w-[1200px] mx-auto">
          <div class="flex-1 min-w-0 max-w-[720px] p-4 text-gray-dark prose">
            <div class="mb-4 py-4 text-center leading-none">
              <div class="mb-2 text-gray">
                <FormattedDate date={pubDate} />
                {
                  updatedDate && (
                    <div class="italic">
                      Last updated on <FormattedDate date={updatedDate} />
                    </div>
                  )
                }
              </div>
              <h1 class="m-0 mb-2">{title}</h1>
              {
                tags && tags.length > 0 && (
                  <div class="flex gap-2 justify-center flex-wrap mt-2">
                    {tags.map((t) => (
                      <Tag tag={t} />
                    ))}
                  </div>
                )
              }
              <hr class="mt-4" />
            </div>
            <slot />
            <div class="mt-8">
              <script
                src="https://giscus.app/client.js"
                data-repo={import.meta.env.PUBLIC_GISCUS_REPO}
                data-repo-id={import.meta.env.PUBLIC_GISCUS_REPO_ID}
                data-category={import.meta.env.PUBLIC_GISCUS_CATEGORY}
                data-category-id={import.meta.env.PUBLIC_GISCUS_CATEGORY_ID}
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="top"
                data-theme="light"
                data-lang="en"
                crossorigin="anonymous"
                async></script>
            </div>
          </div>
          {
            showToc && (
              <aside class="hidden lg:block w-[200px] shrink-0 sticky top-8 self-start p-4 mt-8">
                <h2 class="text-sm m-0 mb-2 text-gray uppercase">Contents</h2>
                <ul class="list-none m-0 p-0">
                  {headings.map((heading) => (
                    <li class="mb-1">
                      <a
                        href={`#${heading.slug}`}
                        class="text-sm text-gray-dark no-underline hover:text-accent"
                      >
                        {heading.text}
                      </a>
                    </li>
                  ))}
                </ul>
              </aside>
            )
          }
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
